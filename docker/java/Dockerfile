FROM gradle:8.12.0-jdk21-corretto AS build

ARG BUILD_WORKDIR
ARG JAVA_CONTAINER_USER

USER ${JAVA_CONTAINER_USER}
COPY --chown=gradle:gradle ./ ${BUILD_WORKDIR}
WORKDIR ${BUILD_WORKDIR}

RUN ./gradlew clean build


FROM eclipse-temurin:21.0.5_11-jre-jammy AS deploy
ARG API_PORT
ARG DEPLOY_WORKDIR
ARG JAVA_CONTAINER_USER
ARG APP_NAME
ARG BUILD_WORKDIR
ENV ENTRY_DEPLOY_WORKDIR ${DEPLOY_WORKDIR}
ENV ENTRY_APP_NAME ${APP_NAME}

WORKDIR ${DEPLOY_WORKDIR}

COPY --from=build "${BUILD_WORKDIR}/build/libs${APP_NAME}" .
EXPOSE 8080

ENTRYPOINT exec java -jar $ENTRY_DEPLOY_WORKDIR$ENTRY_APP_NAME
