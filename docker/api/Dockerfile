FROM eclipse-temurin:21.0.7_6-jdk
ARG API_PORT
ARG LOCALDEV_WORKDIR
ARG JAVA_CONTAINER_USER
ARG JAVA_CONTAINER_USER_ID
ARG APP_NAME
ARG BUILD_WORKDIR

WORKDIR ${LOCALDEV_WORKDIR}
RUN adduser -D ${JAVA_CONTAINER_USER} && \
    chown -R ${JAVA_CONTAINER_USER} .${LOCALDEV_WORKDIR}/
USER ${JAVA_CONTAINER_USER}

COPY gradlew build.gradle setting.gradle .${LOCALDEV_WORKDIR}/
COPY gradle .${LOCALDEV_WORKDIR}/gradle

RUN ./gradlew dependencies --no-daemon || true

EXPOSE ${API_PORT}
